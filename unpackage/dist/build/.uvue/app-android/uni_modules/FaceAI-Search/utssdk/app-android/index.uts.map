{"version":3,"file":"index.uts","sourceRoot":"","sources":["uni_modules/FaceAI-Search/utssdk/app-android/index.uts"],"names":[],"mappings":"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","sourcesContent":["import { StartFaceSearch,AddFaceSearchFeature,DeleteFaceSearchFeature,FaceSearch,InsertFaceSearchFeature,ResultJSON, InsertManyFeatures} from '../interface.uts'\n\nimport Application from 'android.app.Application';\nimport Activity from 'android.app.Activity';\nimport Intent from 'android.content.Intent';\nimport FaceSDKConfig from \"com.faceAI.demo.FaceSDKConfig\";\nimport FaceAISDKNative from \"uts.sdk.modules.uniFaceAISDK.FaceAISDKNative\";\nimport FaceSearchActivity from \"uts.sdk.modules.uniFaceAISDK.FaceSearchActivity\";\nimport FaceResultManager from \"uts.sdk.modules.uniFaceAISDK.FaceResultManager\";\n\n\nimport AddFaceImageActivity from \"com.faceAI.demo.SysCamera.addFace.AddFaceImageActivity\";\nimport BitmapUtils from \"com.faceAI.demo.base.utils.BitmapUtils\";\nimport FaceSearch1NActivity from 'com.faceAI.demo.SysCamera.search.FaceSearch1NActivity';\nimport FaceSearchFeatureManger from 'com.ai.face.faceSearch.search.FaceSearchFeatureManger';\n\n//当前libs目录下为空，复用了HelloKitty 的\n\n//*******************************     下面是1:N 人脸搜索识别的方法（仅Android） ************************************************\n\n/**\n * 启动持续人脸搜索 Activity\n * 该方法会启动 Activity 并不关闭，持续回调数据\n */\nexport const startFaceSearch: StartFaceSearch = function(callback: (jsonResult: string) => void) {\n    const context = UTSAndroid.getUniActivity() as Activity;\n    FaceSDKConfig.init(context);\n\n    FaceResultManager.setCallback(new FaceResultManager.OnFaceResultListener({\n            onResult: (json: string) => {\n                callback(json);\n            }\n        }));\n\n    // 2. 启动搜索 Activity\n    const intent = new Intent(context, FaceSearchActivity().javaClass);\n    // 如果需要设置 Activity 为 SingleTop 或其他启动模式，可以在这里 addFlags\n    context.startActivity(intent);\t\n}\n\n\n\n\n /**\n  *  「1:N人脸搜索」人脸搜索人脸特征更新同步\n  *   自行保证人脸特征值长度为1024\n  */\n export const insertFaceSearchFeature : InsertFaceSearchFeature = \n   function (faceID : string, faceFeature : string, tag : string, group : string, \n   callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n\t\n        //tag 和 group 可以用来做标记和分组。人脸搜索的时候可以加快速度降低误差\n        FaceSearchFeatureManger.getInstance(context)\n                        .insertFaceFeature(faceID, faceFeature, System.currentTimeMillis(),tag,group);\n\t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:1,\n \t\t\t\tmsg:\"success\",\n \t\t\t\tfaceID:faceID,\n \t\t\t\tfaceBase64:\"\",\n \t\t\t\tfaceFeature:\"\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n \n \n \n /**\n  *  「1:N人脸搜索」批量插入人脸特征数据\n  *   自行保证人脸特征值长度为1024\n  */\n export const insertManyFeatures : InsertManyFeatures = \n   function (jsonFaceFeatures : string, \n   callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n \t\n\t\tFaceSearchFeatureManger.getInstance(context)\n\t\t                .insertFeatures(jsonFaceFeatures)\n \t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:1,\n \t\t\t\tmsg:\"success\",\n \t\t\t\tfaceID:\"\",\n \t\t\t\tfaceBase64:\"\",\n \t\t\t\tfaceFeature:\"\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n \n \n \n \n /**\n  *  「1:N人脸搜索」人脸搜索人脸特征更新同步\n  */\n export const deleteFaceSearchFeature : DeleteFaceSearchFeature = \n   function (faceID : string, callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n \t\n        //清除所有人脸搜索所有特征\n        FaceSearchFeatureManger.getInstance(context).deleteFaceFaceFeature(faceID);\n \t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:1,\n \t\t\t\tmsg:\"delete success\",\n \t\t\t\tfaceID:faceID,\n \t\t\t\tfaceBase64:\"\",\n \t\t\t\tfaceFeature:\"\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n\n/**\n * 「1:N人脸搜索」跳转到Android SDK中原生相机页面处理人脸录入\n * \n * @param faceID 用户ID\n * @param addFacePerformanceMode 添加人脸角度检测模式. 1 快速模式   2 精确模式\n * @param callback 结果回调\n */\nexport const addFaceSearchFeature : AddFaceSearchFeature = function (\n    faceID:string,\n\taddFacePerformanceMode:number,\n\tcallback : (result : ResultJSON) => void\n) {\n\tconst context = UTSAndroid.getUniActivity() as Activity\n\tFaceSDKConfig.init(context);\n\tconst intent = new Intent(context, AddFaceImageActivity().javaClass)\n\tintent.putExtra(\"ADD_FACE_IMAGE_TYPE_KEY\", \"FACE_SEARCH\");\n\tintent.putExtra(\"ADD_FACE_PERFORMANCE_MODE\", addFacePerformanceMode);\n\tcontext.startActivityForResult(intent, 10086)\n\n    //语法不熟悉，先保证主流程跑通\n\tUTSAndroid.onAppActivityResult((requestCode : Int, resultCode : Int, intentAct?: Intent) => {\n\t\tif (requestCode == 10086) {\n\t\t\tif(intentAct!=null){\n\t\t\t\tconst codeNow:number = intentAct.getIntExtra(\"code\",0) as number\n\t\t\t\tconst msgNow:string=intentAct.getStringExtra(\"msg\") as string\n                const faceFeatureNoew:string=intentAct.getStringExtra(\"faceFeature\") as string\n\t\t\t\t\n\t\t\t\tlet faceBase64=\"?\"\n\t\t\t\tif(0!=codeNow){\n\t\t\t\t\t//用户取消了就不应该有这个值\n\t\t\t\t\tfaceBase64=BitmapUtils.bitmapToBase64(FaceSDKConfig.CACHE_BASE_FACE_DIR+faceID)\n\t\t\t\t}\n\t\t\t\t \n\t\t\t\tconst resultJson:ResultJSON={\n\t\t\t\t\tcode:codeNow,\n\t\t\t\t\tmsg:msgNow,\n\t\t\t\t\tfaceFeature: faceFeatureNoew,\n\t\t\t\t\tfaceID:\"\",\n\t\t\t\t\tfaceBase64:faceBase64\n\t\t\t\t}\t\t\n\t\t\t\tconsole.log(\"添加人脸人脸：\"+resultJson)\n\t\t\t\tcallback(resultJson)\n\t\t\t}else{\n\t\t\t\tconst resultJson:ResultJSON={\n\t\t\t\t\tcode:-1,\n\t\t\t\t\tmsg:\"添加失败\",\n\t\t\t\t\tfaceFeature: \"\",\n\t\t\t\t\tfaceID:\"\",\n\t\t\t\t\tfaceBase64:\"\"\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tcallback(resultJson)\n\t\t\t}\n\t\t} \n\t});\n}\n\n\n\n/**\n * 1:N，M：N 人脸搜索，开发测试中 完善一下参数\n * \n */\nexport const faceSearch:FaceSearch = function(callback: (res: ResultJSON) => void){\n\t\n\tconst context = UTSAndroid.getUniActivity() as Activity\n\tFaceSDKConfig.init(context);\n\t\n\tconst intent = new Intent(context, FaceSearch1NActivity().javaClass)\n\tcontext.startActivity(intent)\n\t\n\tconst resultJson:ResultJSON={\n\t\tcode: 1,\n\t\tmsg: \"开发测试中\",\n\t\tfaceID: \"faceID8\",\n\t\tfaceBase64: \"64\",\n\t\tfaceFeature: \"\"\n\t}\n    callback(resultJson)\n} \n"]}