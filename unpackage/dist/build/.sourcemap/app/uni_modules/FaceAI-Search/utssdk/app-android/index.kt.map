{"version":3,"sources":["uni_modules/FaceAI-Search/utssdk/app-android/index.uts","uni_modules/FaceAI-Search/utssdk/interface.uts"],"sourcesContent":["import { StartFaceSearch,AddFaceSearchFeature,DeleteFaceSearchFeature,FaceSearch,InsertFaceSearchFeature,ResultJSON, InsertManyFeatures} from '../interface.uts'\n\nimport Application from 'android.app.Application';\nimport Activity from 'android.app.Activity';\nimport Intent from 'android.content.Intent';\nimport FaceSDKConfig from \"com.faceAI.demo.FaceSDKConfig\";\nimport FaceAISDKNative from \"uts.sdk.modules.uniFaceAISDK.FaceAISDKNative\";\nimport FaceSearchActivity from \"uts.sdk.modules.uniFaceAISDK.FaceSearchActivity\";\nimport FaceResultManager from \"uts.sdk.modules.uniFaceAISDK.FaceResultManager\";\n\n\nimport AddFaceImageActivity from \"com.faceAI.demo.SysCamera.addFace.AddFaceImageActivity\";\nimport BitmapUtils from \"com.faceAI.demo.base.utils.BitmapUtils\";\nimport FaceSearch1NActivity from 'com.faceAI.demo.SysCamera.search.FaceSearch1NActivity';\nimport FaceSearchFeatureManger from 'com.ai.face.faceSearch.search.FaceSearchFeatureManger';\n\n//当前libs目录下为空，复用了HelloKitty 的\n\n//*******************************     下面是1:N 人脸搜索识别的方法（仅Android） ************************************************\n\n/**\n * 启动持续人脸搜索 Activity\n * 该方法会启动 Activity 并不关闭，持续回调数据\n */\nexport const startFaceSearch: StartFaceSearch = function(callback: (jsonResult: string) => void) {\n    const context = UTSAndroid.getUniActivity() as Activity;\n    FaceSDKConfig.init(context);\n\n    FaceResultManager.setCallback(new FaceResultManager.OnFaceResultListener({\n            onResult: (json: string) => {\n                callback(json);\n            }\n        }));\n\n    // 2. 启动搜索 Activity\n    const intent = new Intent(context, FaceSearchActivity().javaClass);\n    // 如果需要设置 Activity 为 SingleTop 或其他启动模式，可以在这里 addFlags\n    context.startActivity(intent);\t\n}\n\n\n\n\n /**\n  *  「1:N人脸搜索」人脸搜索人脸特征更新同步\n  *   自行保证人脸特征值长度为1024\n  */\n export const insertFaceSearchFeature : InsertFaceSearchFeature = \n   function (faceID : string, faceFeature : string, tag : string, group : string, \n   callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n\t\n        //tag 和 group 可以用来做标记和分组。人脸搜索的时候可以加快速度降低误差\n        FaceSearchFeatureManger.getInstance(context)\n                        .insertFaceFeature(faceID, faceFeature, System.currentTimeMillis(),tag,group);\n\t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:1,\n \t\t\t\tmsg:\"success\",\n \t\t\t\tfaceID:faceID,\n \t\t\t\tfaceBase64:\"\",\n \t\t\t\tfaceFeature:\"\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n \n \n \n /**\n  *  「1:N人脸搜索」批量插入人脸特征数据\n  *   自行保证人脸特征值长度为1024\n  */\n export const insertManyFeatures : InsertManyFeatures = \n   function (jsonFaceFeatures : string, \n   callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n \t\n\t\tFaceSearchFeatureManger.getInstance(context)\n\t\t                .insertFeatures(jsonFaceFeatures)\n \t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:1,\n \t\t\t\tmsg:\"success\",\n \t\t\t\tfaceID:\"\",\n \t\t\t\tfaceBase64:\"\",\n \t\t\t\tfaceFeature:\"\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n \n \n \n \n /**\n  *  「1:N人脸搜索」人脸搜索人脸特征更新同步\n  */\n export const deleteFaceSearchFeature : DeleteFaceSearchFeature = \n   function (faceID : string, callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n \t\n        //清除所有人脸搜索所有特征\n        FaceSearchFeatureManger.getInstance(context).deleteFaceFaceFeature(faceID);\n \t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:1,\n \t\t\t\tmsg:\"delete success\",\n \t\t\t\tfaceID:faceID,\n \t\t\t\tfaceBase64:\"\",\n \t\t\t\tfaceFeature:\"\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n\n/**\n * 「1:N人脸搜索」跳转到Android SDK中原生相机页面处理人脸录入\n * \n * @param faceID 用户ID\n * @param addFacePerformanceMode 添加人脸角度检测模式. 1 快速模式   2 精确模式\n * @param callback 结果回调\n */\nexport const addFaceSearchFeature : AddFaceSearchFeature = function (\n    faceID:string,\n\taddFacePerformanceMode:number,\n\tcallback : (result : ResultJSON) => void\n) {\n\tconst context = UTSAndroid.getUniActivity() as Activity\n\tFaceSDKConfig.init(context);\n\tconst intent = new Intent(context, AddFaceImageActivity().javaClass)\n\tintent.putExtra(\"ADD_FACE_IMAGE_TYPE_KEY\", \"FACE_SEARCH\");\n\tintent.putExtra(\"ADD_FACE_PERFORMANCE_MODE\", addFacePerformanceMode);\n\tcontext.startActivityForResult(intent, 10086)\n\n    //语法不熟悉，先保证主流程跑通\n\tUTSAndroid.onAppActivityResult((requestCode : Int, resultCode : Int, intentAct?: Intent) => {\n\t\tif (requestCode == 10086) {\n\t\t\tif(intentAct!=null){\n\t\t\t\tconst codeNow:number = intentAct.getIntExtra(\"code\",0) as number\n\t\t\t\tconst msgNow:string=intentAct.getStringExtra(\"msg\") as string\n                const faceFeatureNoew:string=intentAct.getStringExtra(\"faceFeature\") as string\n\t\t\t\t\n\t\t\t\tlet faceBase64=\"?\"\n\t\t\t\tif(0!=codeNow){\n\t\t\t\t\t//用户取消了就不应该有这个值\n\t\t\t\t\tfaceBase64=BitmapUtils.bitmapToBase64(FaceSDKConfig.CACHE_BASE_FACE_DIR+faceID)\n\t\t\t\t}\n\t\t\t\t \n\t\t\t\tconst resultJson:ResultJSON={\n\t\t\t\t\tcode:codeNow,\n\t\t\t\t\tmsg:msgNow,\n\t\t\t\t\tfaceFeature: faceFeatureNoew,\n\t\t\t\t\tfaceID:\"\",\n\t\t\t\t\tfaceBase64:faceBase64\n\t\t\t\t}\t\t\n\t\t\t\tconsole.log(\"添加人脸人脸：\"+resultJson)\n\t\t\t\tcallback(resultJson)\n\t\t\t}else{\n\t\t\t\tconst resultJson:ResultJSON={\n\t\t\t\t\tcode:-1,\n\t\t\t\t\tmsg:\"添加失败\",\n\t\t\t\t\tfaceFeature: \"\",\n\t\t\t\t\tfaceID:\"\",\n\t\t\t\t\tfaceBase64:\"\"\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tcallback(resultJson)\n\t\t\t}\n\t\t} \n\t});\n}\n\n\n\n/**\n * 1:N，M：N 人脸搜索，开发测试中 完善一下参数\n * \n */\nexport const faceSearch:FaceSearch = function(callback: (res: ResultJSON) => void){\n\t\n\tconst context = UTSAndroid.getUniActivity() as Activity\n\tFaceSDKConfig.init(context);\n\t\n\tconst intent = new Intent(context, FaceSearch1NActivity().javaClass)\n\tcontext.startActivity(intent)\n\t\n\tconst resultJson:ResultJSON={\n\t\tcode: 1,\n\t\tmsg: \"开发测试中\",\n\t\tfaceID: \"faceID8\",\n\t\tfaceBase64: \"64\",\n\t\tfaceFeature: \"\"\n\t}\n    callback(resultJson)\n} \n","// 插件对外暴露能力的总入口在 interface.uts ，他与Android/ios 目录下的 index.uts的关系是声明和实现的关系。\n\n\n\n\n\n/**\n * 开启持续人脸搜索 (Activity 常驻)\n * @param callback 接收搜索结果 JSON 字符串的回调\n */\nexport type StartFaceSearch = (callback: (jsonResult: string) => void) => void\n\n\n\n/**\n * 「1:N人脸搜索」录入人脸特征值\n * \n * @param faceID 用户ID\n * @param callback 结果回调\n */\nexport type AddFaceSearchFeature = (\n    faceID:string,\n\taddFacePerformanceMode:number,\n\tcallback : (result : ResultJSON) => void) => void\n\t\n\t\n\t\n/**\n * 「1:N人脸搜索」删除一张人脸照片\n * \n * @param faceID 用户ID\n * @param callback 结果回调\n */\nexport type DeleteFaceSearchFeature = (\n    faceID:string,\n\tcallback : (result : ResultJSON) => void) => void\n\n\n/**\n * 「1:N人脸搜索」更多个性化参数完善中\n */\nexport type FaceSearch = (callback: (res: ResultJSON) => void) => void\n\n\n/**\n * 「1:N人脸搜索」录入一张人脸照片\n * \n * @param faceID 用户ID\n * @param faceFeature 1024长度的提取的人脸特征值\n * @param tag   标签\n * @param group 分组\n * @param callback 结果回调\n */\nexport type InsertFaceSearchFeature = (\n\tfaceID : string,\n\tfaceFeature : string, \n\ttag : string, \n\tgroup : string,\n\tcallback : (result : ResultJSON) => void) => void\n\t\n\t\n/**\n * 「1:N人脸搜索」录入一张人脸照片\n * \n * @param jsonFaceFeatures json 格式数组\n * @param callback 结果回调\n */\nexport type InsertManyFeatures = (\n\tjsonFaceFeatures : string,\n\tcallback : (result : ResultJSON) => void) => void\n\t\n\n\n/**\n * 业务方传给FaceAISDK 插件基础参数\n */\nexport type ResultJSON = {\n  code: number,       //code 含义参考Readme \n  msg: string, \n  faceID: string,     \n  faceFeature: string,  //人脸特征值\n  faceBase64: string    //人脸图Base64编码\n}"],"names":[],"mappings":";;AAGA,OAAqB,oBAAsB,AAAC;AAD5C,OAAwB,uBAAyB,AAAC;AAElD,OAAmB,sBAAwB,AAAC;AAU5C,OAAoC,qDAAuD,AAAC;AAT5F,OAA0B,6BAA+B,AAAC;AAM1D,OAAiC,sDAAwD,AAAC;AAE1F,OAAiC,qDAAuD,AAAC;AADzF,OAAwB,sCAAwC,AAAC;;;;;;;;;;;;;;;;AAJjE,OAA8B,8CAAgD,AAAC;AAD/E,OAA+B,+CAAiD,AAAC;;UCGrE,mBAAmB,WAAW,YAAY,MAAM,KAAK,IAAI,KAAK,IAAI;UAUlE,wBACR,QAAO,MAAM,EAChB,wBAAuB,MAAM,EAC7B,WAAY,QAAS,eAAe,IAAI,KAAK,IAAI;UAUtC,2BACR,QAAO,MAAM,EAChB,WAAY,QAAS,eAAe,IAAI,KAAK,IAAI;UAMtC,cAAc,WAAW,KAAK,eAAe,IAAI,KAAK,IAAI;UAY1D,2BACX,QAAS,MAAM,EACf,aAAc,MAAM,EACpB,KAAM,MAAM,EACZ,OAAQ,MAAM,EACd,WAAY,QAAS,eAAe,IAAI,KAAK,IAAI;UAStC,sBACX,kBAAmB,MAAM,EACzB,WAAY,QAAS,eAAe,IAAI,KAAK,IAAI;AAOzB,WAAb;IACV;mBAAM,MAAM,CAAC;IACb;kBAAK,MAAM,CAAC;IACZ;qBAAQ,MAAM,CAAC;IACf;0BAAa,MAAM,CAAC;IACpB;yBAAY,MAAM,CAAA;;ADzDb,IAAM,mCAAmC,IAAS,WAAW,YAAY,MAAM,KAAK,IAAI,EAAA;IAC3F,IAAM,UAAU,WAAW,cAAc,GAAE,EAAA,CAAI;IAC/C,cAAc,IAAI,CAAC;IAEnB,kBAAkB,WAAW,CAAC,AAAI,kBAAkB,oBAAoB,CAAC;QACjE,IAAA,WAAU,IAAC,MAAM,MAAM,CAAI;YACvB,SAAS;QACb;KACH;IAGL,IAAM,SAAS,AAAI,OAAO,SAAS,qBAAqB,SAAS;IAEjE,QAAQ,aAAa,CAAC;AAC1B;AASQ,IAAM,mDACX,IAAU,QAAS,MAAM,EAAE,aAAc,MAAM,EAAE,KAAM,MAAM,EAAE,OAAQ,MAAM,EAC7E,WAAY,uBAAwB,IAAI,EAAA;IACrC,IAAM,UAAU,WAAW,aAAa,GAAE,EAAA,CAAI;IAC9C,cAAc,IAAI,CAAC;IAGjB,wBAAwB,WAAW,CAAC,SACnB,iBAAiB,CAAC,QAAQ,aAAa,OAAO,iBAAiB,IAAG,KAAI;IAE5F,IAAM,aAAW,WACf,OAAK,CAAC,EACN,MAAI,WACJ,SAAO,QACP,aAAW,IACX,cAAY;IAEd,SAAS;AACV;AAUM,IAAM,yCACX,IAAU,kBAAmB,MAAM,EACnC,WAAY,uBAAwB,IAAI,EAAA;IACrC,IAAM,UAAU,WAAW,aAAa,GAAE,EAAA,CAAI;IAC9C,cAAc,IAAI,CAAC;IAEvB,wBAAwB,WAAW,CAAC,SACnB,cAAc,CAAC;IAE/B,IAAM,aAAW,WACf,OAAK,CAAC,EACN,MAAI,WACJ,SAAO,IACP,aAAW,IACX,cAAY;IAEd,SAAS;AACV;AAUM,IAAM,mDACX,IAAU,QAAS,MAAM,EAAE,WAAY,uBAAwB,IAAI,EAAA;IAChE,IAAM,UAAU,WAAW,aAAa,GAAE,EAAA,CAAI;IAC9C,cAAc,IAAI,CAAC;IAGjB,wBAAwB,WAAW,CAAC,SAAS,qBAAqB,CAAC;IAExE,IAAM,aAAW,WACf,OAAK,CAAC,EACN,MAAI,kBACJ,SAAO,QACP,aAAW,IACX,cAAY;IAEd,SAAS;AACV;AAWK,IAAM,6CAA8C,IACvD,QAAO,MAAM,EAChB,wBAAuB,MAAM,EAC7B,WAAY,uBAAwB,IAAI,EAAA;IAExC,IAAM,UAAU,WAAW,cAAc,GAAE,EAAA,CAAI;IAC/C,cAAc,IAAI,CAAC;IACnB,IAAM,SAAS,AAAI,OAAO,SAAS,uBAAuB,SAAS;IACnE,OAAO,QAAQ,CAAC,2BAA2B;IAC3C,OAAO,QAAQ,CAAC,6BAA6B;IAC7C,QAAQ,sBAAsB,CAAC,QAAQ,KAAK;IAG5C,WAAW,mBAAmB,CAAC,IAAC,aAAc,KAAK,YAAa,KAAK,WAAY,QAAU;QAC1F,IAAI,YAAW,EAAA,CAAI,KAAK,EAAE;YACzB,IAAG,UAAS,EAAA,CAAE,IAAI,EAAC;gBAClB,IAAM,SAAQ,MAAM,GAAG,UAAU,WAAW,CAAC,QAAO,CAAC,EAAC,EAAA,CAAI,MAAM;gBAChE,IAAM,QAAO,MAAM,GAAC,UAAU,cAAc,CAAC,OAAM,EAAA,CAAI,MAAM;gBACjD,IAAM,iBAAgB,MAAM,GAAC,UAAU,cAAc,CAAC,eAAc,EAAA,CAAI,MAAM;gBAE1F,IAAI,aAAW;gBACf,IAAG,CAAC,CAAA,EAAA,CAAE,SAAQ;oBAEb,aAAW,YAAY,cAAc,CAAC,cAAc,mBAAmB,CAAA,CAAA,CAAC;;gBAGzE,IAAM,aAAW,WAChB,OAAK,SACL,MAAI,QACJ,cAAa,iBACb,SAAO,IACP,aAAW;gBAEZ,QAAQ,GAAG,CAAC,UAAS,CAAA,CAAC;gBACtB,SAAS;cACL,IAUJ,CAVI;gBACJ,IAAM,aAAW,WAChB,OAAK,CAAC,CAAC,EACP,MAAI,QACJ,cAAa,IACb,SAAO,IACP,aAAW;gBAGZ,SAAS;;;IAGZ;;AACD;AAQO,IAAM,yBAAwB,IAAS,WAAW,oBAAoB,IAAI,EAAA;IAEhF,IAAM,UAAU,WAAW,cAAc,GAAE,EAAA,CAAI;IAC/C,cAAc,IAAI,CAAC;IAEnB,IAAM,SAAS,AAAI,OAAO,SAAS,uBAAuB,SAAS;IACnE,QAAQ,aAAa,CAAC;IAEtB,IAAM,aAAW,WAChB,OAAM,CAAC,EACP,MAAK,SACL,SAAQ,WACR,aAAY,MACZ,cAAa;IAEX,SAAS;AACb"}