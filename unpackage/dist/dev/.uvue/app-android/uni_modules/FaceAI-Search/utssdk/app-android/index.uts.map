{"version":3,"file":"index.uts","sourceRoot":"","sources":["uni_modules/FaceAI-Search/utssdk/app-android/index.uts"],"names":[],"mappings":"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","sourcesContent":["import { StartFaceSearch,AddFaceSearchFeature,DeleteFaceSearchFeature,FaceSearch,InsertFaceSearchFeature,ResultJSON, InsertManyFeatures} from '../interface.uts'\n\nimport Application from 'android.app.Application';\nimport Activity from 'android.app.Activity';\nimport Intent from 'android.content.Intent';\nimport FaceSDKConfig from \"com.faceAI.demo.FaceSDKConfig\";\nimport FaceAISDKNative from \"uts.sdk.modules.uniFaceAISDK.FaceAISDKNative\";\nimport FaceSearchActivity from \"uts.sdk.modules.uniFaceAISDK.FaceSearchActivity\";\nimport FaceResultManager from \"uts.sdk.modules.uniFaceAISDK.FaceResultManager\";\nimport System from 'java.lang.System'; // 引入 System 类以获取时间戳\nimport AddFaceImageActivity from \"com.faceAI.demo.SysCamera.addFace.AddFaceImageActivity\";\nimport BitmapUtils from \"com.faceAI.demo.base.utils.BitmapUtils\";\nimport FaceSearchFeatureManger from 'com.ai.face.faceSearch.search.FaceSearchFeatureManger';\n\n\n /**\n  * 启动持续人脸搜索 Activity\n  * 该方法会启动 Activity 并不关闭，持续回调数据\n  */\n/**\n * 启动持续人脸搜索 Activity\n * 该方法会启动 Activity 并不关闭，持续回调数据\n */\nexport const startFaceSearch: StartFaceSearch = function(\n    searchThreshold: number,\n    searchOneTime: boolean,\n    isCameraSizeHigh: boolean,\n    cameraId: number,\n    callback: (jsonResult: string) => void\n) {\n\t \n\t UTSAndroid.getUniActivity()!.runOnUiThread(() => {\n\t \tconst context = UTSAndroid.getUniActivity() as Activity\n\t \tFaceSDKConfig.init(context);\n\t\t// UTS 会自动将这个 (json: string) => void 转换为 Kotlin 的 (String) -> Unit\n\t\tFaceResultManager.setCallback((json: string) => {\n\t\t    callback(json);\n\t\t});\n\t\t \n\t\t// 2. 启动搜索 Activity\n\t\tconst intent = new Intent(context, FaceSearchActivity().javaClass);\n\t\tintent.putExtra(\"THRESHOLD_KEY\", searchThreshold);\n\t\tintent.putExtra(\"SEARCH_ONE_TIME\", searchOneTime);\n\t\tintent.putExtra(\"IS_CAMERA_SIZE_HIGH\", isCameraSizeHigh);\n\t\tintent.putExtra(\"CAMERA_ID\", cameraId);\n\t\tcontext.startActivity(intent);\t\n\t });\n }\n \n\n\n/**\n * 「1:N人脸搜索」人脸搜索人脸特征更新同步\n * 自行保证人脸特征值长度为1024\n */\nexport const insertFaceSearchFeature: InsertFaceSearchFeature = function (\n    faceID: string,\n    faceFeature: string,\n    tag: string,\n    group: string,\n    callback: (result: ResultJSON) => void\n) {\n    // 1. 获取 Context\n    const context = UTSAndroid.getAppContext() as Application\n    FaceSDKConfig.init(context);\n\n    // 2. 【校验】验证 faceID 不能为空\n    if (faceID == null || faceID.trim() == \"\") {\n        const errorResult: ResultJSON = {\n            code: -1, // 错误码\n            msg: \"参数错误: faceID 不能为空\"\n        }\n        __f__('error','at uni_modules/FaceAI-Search/utssdk/app-android/index.uts:73',errorResult.msg)\n        callback(errorResult)\n        return // 终止执行\n    }\n\n    // 3. 【校验】验证 faceFeature 长度必须为 1024\n    if (faceFeature == null || faceFeature.length != 1024) {\n        const currentLen = (faceFeature == null) ? 0 : faceFeature.length;\n        const errorResult: ResultJSON = {\n            code: -2, // 错误码\n            msg: \"参数错误: faceFeature 长度必须为 1024 (当前长度: \" + currentLen + \")\"\n        }\n        __f__('error','at uni_modules/FaceAI-Search/utssdk/app-android/index.uts:85',errorResult.msg)\n        callback(errorResult)\n        return // 终止执行\n    }\n\n    // 4. 【执行】调用 Native 方法，并增加异常捕获\n    try {\n        // tag 和 group 可以用来做标记和分组\n        // 建议：如果 tag/group 为空，可以传默认值，防止 Native 端空指针（视 Native 实现而定）\n        const safeTag = (tag == null) ? \"\" : tag;\n        const safeGroup = (group == null) ? \"\" : group;\n\n        const isSuccess = FaceSearchFeatureManger.getInstance(context)\n            .insertFaceFeature(faceID, faceFeature, System.currentTimeMillis(), safeTag, safeGroup);\n\n        // 假设 Native 方法返回 boolean (如果 Native 是 void，则这里只代表调用成功)\n        // 构造成功回调\n        const successResult: ResultJSON = {\n            code: 1,\n            msg: \"success\"\n        }\n        callback(successResult)\n\n    } catch (e: Exception) {\n        // 5. 【异常处理】捕获 Java 层可能的崩溃\n        const catchResult: ResultJSON = {\n            code: -3,\n            msg: \"Native 执行异常: \" + e.message\n        }\n        __f__('error','at uni_modules/FaceAI-Search/utssdk/app-android/index.uts:114',\"insertFaceSearchFeature error: \" + e.message)\n        callback(catchResult)\n    }\n}\n \n \n \n \n /**\n  *  「1:N人脸搜索」批量插入人脸特征数据\n  *   自行保证人脸特征值长度为1024\n  */\n export const insertManyFeatures : InsertManyFeatures = \n   function (jsonFaceFeatures : string, \n   callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n \t\n\t\tlet faceCount = FaceSearchFeatureManger.getInstance(context)\n\t\t                .insertFeatures(jsonFaceFeatures)\n \t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:faceCount,\n \t\t\t\tmsg:\"insertManyFeatures\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n \n \n \n \n /**\n  *  「1:N人脸搜索」人脸搜索人脸特征更新同步\n  */\n export const deleteFaceSearchFeature : DeleteFaceSearchFeature = \n   function (faceID : string, callback : (result : ResultJSON) => void) {\n \t    const context = UTSAndroid.getAppContext() as Application\n \t    FaceSDKConfig.init(context);\t\n \t\n        //清除所有人脸搜索所有特征\n        FaceSearchFeatureManger.getInstance(context).deleteFaceFaceFeature(faceID);\n \t\n \t\tconst resultJson:ResultJSON={\n \t\t\t\tcode:1,\n \t\t\t\tmsg:\"delete success\"\n \t\t\t}\t\n \t\tcallback(resultJson)\n \t})\n }\n \n\n/**\n * 「1:N人脸搜索」跳转到Android SDK中原生相机页面处理人脸录入\n * \n * @param faceID 用户ID\n * @param addFacePerformanceMode 添加人脸角度检测模式. 1 快速模式   2 精确模式\n * @param callback 结果回调\n */\nexport const addFaceSearchFeature : AddFaceSearchFeature = function (\n    faceID:string,\n\taddFacePerformanceMode:number,\n\tcallback : (result : ResultJSON) => void\n) {\n\t\n\tUTSAndroid.getUniActivity()!.runOnUiThread(() => {\n\t\tconst context = UTSAndroid.getUniActivity() as Activity\n\t\tFaceSDKConfig.init(context);\n\t\tconst intent = new Intent(context, AddFaceImageActivity().javaClass)\n\t\tintent.putExtra(\"ADD_FACE_IMAGE_TYPE_KEY\", \"FACE_SEARCH\");\n\t\tintent.putExtra(\"ADD_FACE_PERFORMANCE_MODE\", addFacePerformanceMode);\n\t\tcontext.startActivityForResult(intent, 10086)\n\t});\n\t\n    //语法不熟悉，先保证主流程跑通\n\tUTSAndroid.onAppActivityResult((requestCode : Int, resultCode : Int, intentAct?: Intent) => {\n\t\tif (requestCode == 10086) {\n\t\t\tif(intentAct!=null){\n\t\t\t\tconst codeNow:number = intentAct.getIntExtra(\"code\",0) as number\n\t\t\t\tconst msgNow:string=intentAct.getStringExtra(\"msg\") as string\n                const faceFeatureNoew:string=intentAct.getStringExtra(\"faceFeature\") as string\n\t\t\t\t\n\t\t\t\tlet faceBase64=\"?\"\n\t\t\t\tif(0!=codeNow){\n\t\t\t\t\t//用户取消了就不应该有这个值\n\t\t\t\t\tfaceBase64=BitmapUtils.bitmapToBase64(FaceSDKConfig.CACHE_BASE_FACE_DIR+faceID)\n\t\t\t\t}\n\t\t\t\t \n\t\t\t\tconst resultJson:ResultJSON={\n\t\t\t\t\tcode:codeNow,\n\t\t\t\t\tmsg:msgNow\n\t\t\t\t}\t\t\n\t\t\t\t__f__('log','at uni_modules/FaceAI-Search/utssdk/app-android/index.uts:207',\"添加人脸人脸：\"+resultJson)\n\t\t\t\tcallback(resultJson)\n\t\t\t}else{\n\t\t\t\tconst resultJson:ResultJSON={\n\t\t\t\t\tcode:-1,\n\t\t\t\t\tmsg:\"添加失败\"\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tcallback(resultJson)\n\t\t\t}\n\t\t} \n\t});\n}\n"]}